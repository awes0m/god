<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consciousness & Creation - Interactive Infographic</title>
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
        
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        #content-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2;
            opacity: 0;
            pointer-events: none;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            overflow-y: auto;
            transition: opacity 1s ease-in-out;
        }
        
        #content-container.active {
            opacity: 1;
            pointer-events: all;
        }
        
        #config-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 3;
            opacity: 0;
            pointer-events: none;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            overflow-y: auto;
            transition: opacity 0.5s ease-in-out;
        }
        
        #config-container.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .consciousness-label {
            position: absolute;
            color: #60a5fa;
            font-size: 18px;
            font-weight: 300;
            text-shadow: 0 0 20px #60a5fa;
            pointer-events: none;
            z-index: 10;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .follow-up-button {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .follow-up-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .media-container {
            border-top: 1px solid rgba(75, 85, 99, 0.3);
            padding-top: 2rem;
        }
        
        .link-preview:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(96, 165, 250, 0.1);
        }
        
        .video-embed iframe {
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        
        audio {
            filter: invert(1) hue-rotate(180deg);
        }

        .transition-all {
            transition: all 0.5s ease;
        }
        
        .duration-2000 {
            transition-duration: 2s;
        }
        
        #splash-screen {
            background: radial-gradient(circle at center, #0a0a0a 0%, #000000 100%);
        }
        
        #splash-text {
            text-shadow: 0 0 30px rgba(96, 165, 250, 0.3);
            letter-spacing: 0.05em;
        }

        @media (max-width: 768px) {
            .consciousness-label {
                font-size: 14px;
            }
            
            #content-container {
                padding: 20px;
            }
            
            #splash-text {
                font-size: 2rem;
                padding: 0 20px;
            }
            
            .link-preview .flex {
                flex-direction: column;
                space-x: 0;
            }
            
            .link-preview .flex-shrink-0 {
                margin-bottom: 1rem;
            }
            
            .video-embed {
                margin-bottom: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- 3D Canvas Container -->
    <div id="canvas-container"></div>
    
    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-black">
        <div class="text-center">
            <h1 id="splash-text" class="text-4xl md:text-6xl font-light text-white opacity-0 transform translate-y-4 transition-all duration-2000 ease-out">
                In the beginning there was nothing but...
            </h1>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-40 flex items-center justify-center bg-black opacity-0 pointer-events-none transition-opacity duration-1000">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto mb-4"></div>
            <p class="text-white text-lg">Loading cosmic data...</p>
        </div>
    </div>
    
    <!-- Consciousness Label -->
    <div id="consciousness-label" class="consciousness-label">Consciousness</div>
    
    <!-- 2D Content Container -->
    <div id="content-container" class="flex items-center justify-center p-8">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h1 id="question-title" class="text-4xl md:text-6xl font-light text-white mb-8 leading-tight">
                    What is Consciousness?
                </h1>
            </div>
            
            <div class="bg-black bg-opacity-30 backdrop-blur-sm rounded-2xl p-8 md:p-12 mb-8 border border-blue-500 border-opacity-20">
                <div id="answer-content" class="text-lg md:text-xl text-gray-200 leading-relaxed">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                </div>
            </div>
            
            <div id="follow-ups-container" class="flex flex-wrap gap-4 justify-center">
                <!-- Follow-up buttons will be inserted here -->
            </div>
            
            <div class="text-center mt-12">
                <button onclick="returnToUniverse()" class="text-blue-400 hover:text-blue-300 transition-colors duration-300 underline">
                    Return to Universe
                </button>
            </div>
        </div>
    </div>
    
    <!-- Config Container -->
    <div id="config-container" class="p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-light text-white mb-4">Content Management System</h1>
                <p class="text-gray-400 text-lg">Manage the JSON data structure that powers your infographic journey</p>
            </div>
            
            <!-- Status Messages -->
            <div id="status-message" class="hidden mb-6 p-4 rounded-lg border">
                <span id="status-text"></span>
            </div>
            
            <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                <!-- File Operations Panel -->
                <div class="bg-black bg-opacity-50 backdrop-blur-sm rounded-2xl p-6 border border-blue-500 border-opacity-20">
                    <h2 class="text-xl font-semibold text-white mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                        File Operations
                    </h2>
                    
                    <!-- Upload JSON -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Upload JSON File</label>
                        <div class="relative">
                            <input type="file" id="json-file-input" accept=".json" class="hidden" onchange="handleFileUpload(event)">
                            <button onclick="document.getElementById('json-file-input').click()" 
                                    class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                Upload JSON File
                            </button>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">Select a .json file to load new content structure</p>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="space-y-3">
                        <button onclick="loadCurrentJSON()" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Load Current Data
                        </button>
                        
                        <button onclick="validateJSON()" 
                                class="w-full bg-amber-600 hover:bg-amber-700 text-white py-2.5 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Validate JSON
                        </button>
                        
                        <button onclick="formatJSON()" 
                                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2.5 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                            </svg>
                            Format & Clean
                        </button>
                        
                        <button onclick="previewChanges()" 
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2.5 px-4 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            Preview Changes
                        </button>
                    </div>
                    
                    <!-- Save & Download -->
                    <div class="mt-8 pt-6 border-t border-gray-700">
                        <button onclick="saveJSON()" 
                                class="w-full follow-up-button py-3 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            Download Updated JSON
                        </button>
                    </div>
                    
                    <!-- Return to Main -->
                    <div class="mt-4">
                        <button onclick="returnToMain()" 
                                class="w-full bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg transition-colors duration-300 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            Return to Experience
                        </button>
                    </div>
                </div>
                
                <!-- JSON Editor Panel -->
                <div class="xl:col-span-2 bg-black bg-opacity-50 backdrop-blur-sm rounded-2xl p-6 border border-blue-500 border-opacity-20">
                    <h2 class="text-xl font-semibold text-white mb-4 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                        </svg>
                        JSON Data Editor
                        <span id="json-status" class="ml-auto text-sm px-2 py-1 rounded-full bg-gray-700 text-gray-300">Ready</span>
                    </h2>
                    
                    <!-- Editor Controls -->
                    <div class="flex flex-wrap gap-2 mb-4">
                        <div class="flex items-center space-x-2 text-sm text-gray-400">
                            <span>Lines: <span id="line-count">0</span></span>
                            <span>•</span>
                            <span>Characters: <span id="char-count">0</span></span>
                            <span>•</span>
                            <span>Nodes: <span id="node-count">0</span></span>
                        </div>
                    </div>
                    
                    <div class="relative">
                        <textarea id="json-editor" 
                                  class="w-full h-96 bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg border border-gray-700 focus:border-blue-500 focus:outline-none resize-none" 
                                  placeholder="Upload a JSON file or click 'Load Current Data' to begin editing..."
                                  oninput="updateStats()"
                                  onkeydown="handleEditorKeydown(event)"></textarea>
                        
                        <!-- Editor Toolbar -->
                        <div class="absolute bottom-4 right-4 flex space-x-2">
                            <button onclick="copyToClipboard()" 
                                    class="bg-gray-800 hover:bg-gray-700 text-white p-2 rounded-md transition-colors duration-300 opacity-75 hover:opacity-100"
                                    title="Copy to clipboard">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                            <button onclick="clearEditor()" 
                                    class="bg-red-800 hover:bg-red-700 text-white p-2 rounded-md transition-colors duration-300 opacity-75 hover:opacity-100"
                                    title="Clear editor">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Instructions Panel -->
                    <div class="mt-6 bg-gray-900 bg-opacity-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            JSON Structure Guide
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                            <div>
                                <h4 class="text-blue-400 font-semibold mb-2">Required Structure:</h4>
                                <ul class="space-y-1">
                                    <li>• <code class="text-green-400">startNode</code>: ID of the first node</li>
                                    <li>• <code class="text-green-400">nodes</code>: Object containing all content nodes</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="text-blue-400 font-semibold mb-2">Node Properties:</h4>
                                <ul class="space-y-1">
                                    <li>• <code class="text-green-400">question</code>: Main question/title</li>
                                    <li>• <code class="text-green-400">answer</code>: Content text (HTML allowed)</li>
                                    <li>• <code class="text-green-400">followUps</code>: Array of next questions</li>
                                    <li>• <code class="text-green-400">media</code>: Array of media items (optional)</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h4 class="text-blue-400 font-semibold mb-2">Media Types Supported:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                                <div>
                                    <h5 class="text-white font-medium mb-2">Videos:</h5>
                                    <ul class="space-y-1 text-xs">
                                        <li>• YouTube embeds</li>
                                        <li>• Vimeo embeds</li>
                                        <li>• Direct MP4 files</li>
                                        <li>• Auto-play support</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="text-white font-medium mb-2">Links:</h5>
                                    <ul class="space-y-1 text-xs">
                                        <li>• Rich link previews</li>
                                        <li>• Custom titles & descriptions</li>
                                        <li>• Preview images</li>
                                        <li>• Favicons support</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="text-white font-medium mb-2">Images:</h5>
                                    <ul class="space-y-1 text-xs">
                                        <li>• Full-size modal view</li>
                                        <li>• Lazy loading</li>
                                        <li>• Responsive sizing</li>
                                        <li>• Captions support</li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="text-white font-medium mb-2">Audio:</h5>
                                    <ul class="space-y-1 text-xs">
                                        <li>• MP3, WAV, OGG support</li>
                                        <li>• Custom controls</li>
                                        <li>• Auto-play options</li>
                                        <li>• Titles & descriptions</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-3 bg-yellow-900 bg-opacity-30 rounded border-l-4 border-yellow-400">
                            <p class="text-yellow-200 text-sm">
                                <strong>Media Example:</strong> Add a "media" array to any node with objects containing "type", "url", "title", and "description" properties.
                            </p>
                        </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-blue-900 bg-opacity-30 rounded border-l-4 border-blue-400">
                            <p class="text-blue-200 text-sm">
                                <strong>Important:</strong> This application loads content from an external 'data.json' file. 
                                Create and place your JSON file in the same directory as this HTML file, then reload the page.
                            </p>
                        </div>
                        
                        <div class="mt-4 p-3 bg-green-900 bg-opacity-30 rounded border-l-4 border-green-400">
                            <p class="text-green-200 text-sm">
                                <strong>Pro Tip:</strong> Use the validation and formatting tools to ensure your JSON is properly structured before downloading.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, consciousnessOrb;
        let particles = [];
        let animationPhase = 'initial'; // 'initial', 'emergence', 'burst', 'universe'
        let isTransitioning = false;
        let currentNodeId = null;
        let contentData = null;

        // Initialize the application based on URL hash
        function init() {
            const hash = window.location.hash.substring(1);
            
            if (hash === 'config') {
                showConfig();
            } else {
                showSplashScreen();
                loadDataFromFile();
            }
        }

        // Show splash screen with animation
        function showSplashScreen() {
            const splashText = document.getElementById('splash-text');
            
            setTimeout(() => {
                splashText.style.opacity = '1';
                splashText.style.transform = 'translateY(0)';
            }, 500);
            
            // Hide splash after animation
            setTimeout(() => {
                const splashScreen = document.getElementById('splash-screen');
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 1000);
            }, 4000);
        }

        // Load data from external JSON file
        async function loadDataFromFile() {
            showLoading(true);
            
            try {
                const response = await fetch('data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                contentData = await response.json();
                
                // Validate the loaded data
                if (!validateJSONStructure(contentData)) {
                    throw new Error('Invalid JSON structure in data.json');
                }
                
                currentNodeId = contentData.startNode;
                
                showLoading(false);
                
                // Start the 3D experience after data is loaded
                setTimeout(() => {
                    setupThreeJS();
                    startAnimation();
                }, 1000);
                
            } catch (error) {
                showLoading(false);
                showDataLoadError(error.message);
            }
        }

        // Show/hide loading screen
        function showLoading(show) {
            const loadingScreen = document.getElementById('loading-screen');
            if (show) {
                loadingScreen.style.opacity = '1';
                loadingScreen.style.pointerEvents = 'all';
            } else {
                loadingScreen.style.opacity = '0';
                loadingScreen.style.pointerEvents = 'none';
            }
        }

        // Show error when data.json cannot be loaded
        function showDataLoadError(errorMessage) {
            const splashScreen = document.getElementById('splash-screen');
            const splashText = document.getElementById('splash-text');
            
            splashScreen.style.display = 'flex';
            splashScreen.style.opacity = '1';
            splashText.innerHTML = `
                <div class="text-center">
                    <h1 class="text-2xl md:text-4xl font-light text-red-400 mb-4">
                        Unable to Load Cosmic Data
                    </h1>
                    <p class="text-lg text-gray-300 mb-8">
                        ${errorMessage}
                    </p>
                    <div class="space-y-4">
                        <p class="text-sm text-gray-400">
                            Please ensure 'data.json' exists in the same directory as this HTML file.
                        </p>
                        <div class="flex justify-center space-x-4">
                            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors duration-300">
                                Retry Loading
                            </button>
                            <button onclick="window.location.hash='config'" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors duration-300">
                                Go to Config
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Setup Three.js scene
        function setupThreeJS() {
            // Scene setup
            scene = new THREE.Scene();
            
            // Add realistic starfield background
            createStarfield();
            
            // Add nebula-like background
            createNebulaBackground();
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000008); // Very dark blue instead of pure black
            
            // Clear any existing canvas
            const canvasContainer = document.getElementById('canvas-container');
            canvasContainer.innerHTML = '';
            canvasContainer.appendChild(renderer.domElement);
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            // Create consciousness orb (initially invisible)
            const orbGeometry = new THREE.SphereGeometry(0.1, 32, 32);
            const orbMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x60a5fa,
                transparent: true,
                opacity: 0
            });
            consciousnessOrb = new THREE.Mesh(orbGeometry, orbMaterial);
            scene.add(consciousnessOrb);
            
            // Add click handler to consciousness orb
            renderer.domElement.addEventListener('click', onCanvasClick);
        }

        // Create realistic starfield background
        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 2000;
            
            const positions = new Float32Array(starCount * 3);
            const colors = new Float32Array(starCount * 3);
            const sizes = new Float32Array(starCount);
            
            for (let i = 0; i < starCount; i++) {
                // Random positions in a large sphere
                const radius = 100 + Math.random() * 400;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                
                positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                positions[i * 3 + 2] = radius * Math.cos(phi);
                
                // Star colors - mix of white, blue, and yellow stars
                const temp = Math.random();
                if (temp < 0.7) {
                    // White stars
                    colors[i * 3] = 1;
                    colors[i * 3 + 1] = 1;
                    colors[i * 3 + 2] = 1;
                } else if (temp < 0.85) {
                    // Blue stars
                    colors[i * 3] = 0.7;
                    colors[i * 3 + 1] = 0.8;
                    colors[i * 3 + 2] = 1;
                } else {
                    // Yellow/orange stars
                    colors[i * 3] = 1;
                    colors[i * 3 + 1] = 0.8;
                    colors[i * 3 + 2] = 0.6;
                }
                
                sizes[i] = Math.random() * 2 + 0.5;
            }
            
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            starGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
            
            const starMaterial = new THREE.PointsMaterial({
                size: 1,
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true,
                opacity: 0.8
            });
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // Create nebula-like background with multiple layers
        function createNebulaBackground() {
            // Create multiple nebula clouds
            for (let i = 0; i < 3; i++) {
                const nebulaGeometry = new THREE.SphereGeometry(50 + i * 20, 32, 32);
                
                // Different nebula colors
                const nebulaColors = [
                    { r: 0.2, g: 0.1, b: 0.4 }, // Purple
                    { r: 0.1, g: 0.2, b: 0.4 }, // Blue
                    { r: 0.3, g: 0.1, b: 0.2 }  // Magenta
                ];
                
                const color = nebulaColors[i];
                const nebulaMaterial = new THREE.MeshBasicMaterial({
                    color: new THREE.Color(color.r, color.g, color.b),
                    transparent: true,
                    opacity: 0.03 + i * 0.01,
                    side: THREE.BackSide
                });
                
                const nebula = new THREE.Mesh(nebulaGeometry, nebulaMaterial);
                
                // Position nebulae randomly
                nebula.position.set(
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100 - 50
                );
                
                scene.add(nebula);
            }
            
            // Add cosmic dust effect
            createCosmicDust();
        }

        // Create cosmic dust particles
        function createCosmicDust() {
            const dustGeometry = new THREE.BufferGeometry();
            const dustCount = 500;
            
            const positions = new Float32Array(dustCount * 3);
            const colors = new Float32Array(dustCount * 3);
            
            for (let i = 0; i < dustCount; i++) {
                // Random positions in space
                positions[i * 3] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 200;
                
                // Subtle dust colors
                const brightness = 0.1 + Math.random() * 0.2;
                colors[i * 3] = brightness * 0.8;
                colors[i * 3 + 1] = brightness * 0.9;
                colors[i * 3 + 2] = brightness;
            }
            
            dustGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            dustGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const dustMaterial = new THREE.PointsMaterial({
                size: 0.5,
                sizeAttenuation: true,
                vertexColors: true,
                transparent: true,
                opacity: 0.3
            });
            
            const dust = new THREE.Points(dustGeometry, dustMaterial);
            scene.add(dust);
        }

        // Animation sequence
        function startAnimation() {
            setTimeout(() => {
                animationPhase = 'emergence';
                emergenceAnimation();
            }, 1000);
        }

        function emergenceAnimation() {
            const startTime = Date.now();
            const duration = 2000;
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Fade in the consciousness orb
                consciousnessOrb.material.opacity = progress;
                consciousnessOrb.scale.setScalar(progress);
                
                // Show label
                if (progress > 0.5) {
                    const label = document.getElementById('consciousness-label');
                    label.style.opacity = (progress - 0.5) * 2;
                    updateLabelPosition();
                }
                
                renderer.render(scene, camera);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    animationPhase = 'waiting';
                    startMainLoop();
                }
            }
            
            animate();
        }

        function burstAnimation() {
            const startTime = Date.now();
            const duration = 1500;
            
            // Create burst effect
            const burstGeometry = new THREE.SphereGeometry(0.1, 16, 16);
            const burstMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x60a5fa,
                transparent: true,
                opacity: 1
            });
            const burst = new THREE.Mesh(burstGeometry, burstMaterial);
            scene.add(burst);
            
            // Create particles
            createParticles();
            
            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Expand and fade burst
                const scale = 1 + progress * 50;
                burst.scale.setScalar(scale);
                burst.material.opacity = 1 - progress;
                
                // Animate particles
                particles.forEach(particle => {
                    particle.position.add(particle.velocity);
                    particle.velocity.multiplyScalar(0.99);
                });
                
                renderer.render(scene, camera);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    scene.remove(burst);
                    transformParticles();
                    animationPhase = 'universe';
                }
            }
            
            animate();
        }

        function createParticles() {
            const particleCount = 200;
            
            for (let i = 0; i < particleCount; i++) {
                const geometry = new THREE.SphereGeometry(0.02, 8, 8);
                const material = new THREE.MeshBasicMaterial({ 
                    color: new THREE.Color().setHSL(Math.random() * 0.1 + 0.55, 0.8, 0.6)
                });
                
                const particle = new THREE.Mesh(geometry, material);
                
                // Random direction from center
                const direction = new THREE.Vector3(
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 2,
                    (Math.random() - 0.5) * 2
                ).normalize();
                
                particle.position.set(0, 0, 0);
                particle.velocity = direction.multiplyScalar(0.1 + Math.random() * 0.1);
                
                particles.push(particle);
                scene.add(particle);
            }
        }

        function transformParticles() {
            particles.forEach((particle, index) => {
                setTimeout(() => {
                    // Randomly decide if this becomes a star or planet
                    if (Math.random() > 0.7) {
                        // Transform to planet
                        particle.scale.setScalar(2 + Math.random() * 2);
                        particle.material.color.setHSL(Math.random(), 0.6, 0.5);
                    } else {
                        // Transform to star (glowing point)
                        particle.scale.setScalar(0.5);
                        particle.material.color.setHex(0xffffff);
                        
                        // Add glow effect
                        const glowGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                        const glowMaterial = new THREE.MeshBasicMaterial({
                            color: 0xffffff,
                            transparent: true,
                            opacity: 0.3
                        });
                        const glow = new THREE.Mesh(glowGeometry, glowMaterial);
                        particle.add(glow);
                    }
                }, index * 50);
            });
        }

        function startMainLoop() {
            function animate() {
                if (animationPhase === 'waiting') {
                    // Gentle pulsing of consciousness orb
                    const time = Date.now() * 0.001;
                    consciousnessOrb.scale.setScalar(1 + Math.sin(time * 2) * 0.1);
                    
                    updateLabelPosition();
                }
                
                if (animationPhase === 'universe') {
                    // Gentle floating motion for particles
                    particles.forEach((particle, index) => {
                        const time = Date.now() * 0.0005 + index * 0.1;
                        particle.position.y += Math.sin(time) * 0.0001;
                        particle.rotation.y += 0.001;
                    });
                    
                    // Keep consciousness orb pulsing gently
                    const time = Date.now() * 0.001;
                    consciousnessOrb.scale.setScalar(1 + Math.sin(time * 2) * 0.05);
                }
                
                // Subtle rotation of the entire scene for cosmic movement
                if (scene) {
                    scene.rotation.y += 0.0001;
                }
                
                renderer.render(scene, camera);
                
                if (!isTransitioning) {
                    requestAnimationFrame(animate);
                }
            }
            
            animate();
        }

        function updateLabelPosition() {
            // Project 3D position to 2D screen coordinates
            const vector = consciousnessOrb.position.clone();
            vector.project(camera);
            
            const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const y = (vector.y * -0.5 + 0.5) * window.innerHeight;
            
            const label = document.getElementById('consciousness-label');
            label.style.left = (x + 20) + 'px';
            label.style.top = (y - 30) + 'px';
        }

        function onCanvasClick(event) {
            if (animationPhase !== 'waiting' && animationPhase !== 'universe') return;
            
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            
            const intersects = raycaster.intersectObjects([consciousnessOrb]);
            
            if (intersects.length > 0) {
                startJourney();
            }
        }

        function startJourney() {
            if (isTransitioning) return;
            
            isTransitioning = true;
            
            if (animationPhase === 'waiting') {
                // Trigger burst animation first
                animationPhase = 'burst';
                burstAnimation();
                
                setTimeout(() => {
                    transitionToContent();
                }, 2000);
            } else {
                transitionToContent();
            }
        }

        function transitionToContent() {
            // Hide label
            document.getElementById('consciousness-label').style.opacity = '0';
            
            // Fade out canvas
            const canvas = document.getElementById('canvas-container');
            canvas.style.transition = 'opacity 1s ease-in-out';
            canvas.style.opacity = '0';
            
            // Fade in content
            setTimeout(() => {
                document.body.style.overflow = 'auto';
                loadNode(currentNodeId);
                document.getElementById('content-container').classList.add('active');
            }, 1000);
        }

        function loadNode(nodeId) {
            const node = contentData.nodes[nodeId];
            if (!node) return;
            
            currentNodeId = nodeId;
            
            // Update content
            document.getElementById('question-title').textContent = node.question;
            
            // Process answer content with media support
            const answerContainer = document.getElementById('answer-content');
            answerContainer.innerHTML = processAnswerContent(node.answer, node.media);
            
            // Update follow-ups
            const followUpsContainer = document.getElementById('follow-ups-container');
            followUpsContainer.innerHTML = '';
            
            node.followUps.forEach(followUp => {
                const button = document.createElement('button');
                button.className = 'follow-up-button';
                button.textContent = followUp.prompt;
                button.onclick = () => navigateToNode(followUp.nextNodeId);
                followUpsContainer.appendChild(button);
            });
            
            // Initialize any embedded content
            setTimeout(() => {
                initializeEmbeddedContent();
            }, 100);
        }

        function processAnswerContent(answer, media) {
            let processedContent = answer;
            
            // If media exists, add it to the content
            if (media && Array.isArray(media)) {
                let mediaHTML = '';
                
                media.forEach((item, index) => {
                    switch (item.type) {
                        case 'video':
                            mediaHTML += createVideoEmbed(item);
                            break;
                        case 'link':
                            mediaHTML += createLinkPreview(item);
                            break;
                        case 'image':
                            mediaHTML += createImageEmbed(item);
                            break;
                        case 'audio':
                            mediaHTML += createAudioEmbed(item);
                            break;
                    }
                });
                
                // Add media after the text content
                processedContent += '<div class="media-container mt-8">' + mediaHTML + '</div>';
            }
            
            return processedContent;
        }

        function createVideoEmbed(videoItem) {
            const { url, title = 'Video', description = '', autoplay = false, width = '100%', height = '315' } = videoItem;
            
            // Handle different video platforms
            let embedHTML = '';
            
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = extractYouTubeID(url);
                const autoplayParam = autoplay ? '&autoplay=1' : '';
                embedHTML = `
                    <div class="video-embed mb-6">
                        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
                            <iframe 
                                class="absolute top-0 left-0 w-full h-full rounded-lg"
                                src="https://www.youtube.com/embed/${videoId}?rel=0${autoplayParam}"
                                title="${title}"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>
                        ${title ? `<h4 class="text-white font-semibold mt-3">${title}</h4>` : ''}
                        ${description ? `<p class="text-gray-300 text-sm mt-2">${description}</p>` : ''}
                    </div>
                `;
            } else if (url.includes('vimeo.com')) {
                const videoId = extractVimeoID(url);
                const autoplayParam = autoplay ? '&autoplay=1' : '';
                embedHTML = `
                    <div class="video-embed mb-6">
                        <div class="relative w-full" style="padding-bottom: 56.25%; height: 0;">
                            <iframe 
                                class="absolute top-0 left-0 w-full h-full rounded-lg"
                                src="https://player.vimeo.com/video/${videoId}?color=60a5fa${autoplayParam}"
                                title="${title}"
                                frameborder="0"
                                allow="autoplay; fullscreen; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>
                        ${title ? `<h4 class="text-white font-semibold mt-3">${title}</h4>` : ''}
                        ${description ? `<p class="text-gray-300 text-sm mt-2">${description}</p>` : ''}
                    </div>
                `;
            } else {
                // Generic video embed
                embedHTML = `
                    <div class="video-embed mb-6">
                        <video 
                            class="w-full rounded-lg"
                            width="${width}" 
                            height="${height}"
                            controls
                            ${autoplay ? 'autoplay' : ''}
                            preload="metadata">
                            <source src="${url}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        ${title ? `<h4 class="text-white font-semibold mt-3">${title}</h4>` : ''}
                        ${description ? `<p class="text-gray-300 text-sm mt-2">${description}</p>` : ''}
                    </div>
                `;
            }
            
            return embedHTML;
        }

        function createLinkPreview(linkItem) {
            const { url, title, description, image, favicon, domain } = linkItem;
            
            return `
                <div class="link-preview mb-6 bg-gray-800 bg-opacity-50 rounded-lg p-4 border border-gray-600 hover:border-blue-400 transition-colors duration-300">
                    <a href="${url}" target="_blank" rel="noopener noreferrer" class="block">
                        <div class="flex items-start space-x-4">
                            ${image ? `
                                <div class="flex-shrink-0">
                                    <img src="${image}" alt="${title || 'Link preview'}" class="w-20 h-20 object-cover rounded-lg">
                                </div>
                            ` : ''}
                            <div class="flex-grow min-w-0">
                                <div class="flex items-center space-x-2 mb-2">
                                    ${favicon ? `<img src="${favicon}" alt="" class="w-4 h-4">` : ''}
                                    <span class="text-blue-400 text-sm font-medium">${domain || new URL(url).hostname}</span>
                                </div>
                                <h4 class="text-white font-semibold line-clamp-2 hover:text-blue-300 transition-colors duration-200">
                                    ${title || url}
                                </h4>
                                ${description ? `
                                    <p class="text-gray-300 text-sm mt-2 line-clamp-3">${description}</p>
                                ` : ''}
                                <div class="flex items-center mt-3">
                                    <svg class="w-4 h-4 text-blue-400 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                    <span class="text-blue-400 text-sm">Open Link</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            `;
        }

        function createImageEmbed(imageItem) {
            const { url, title, description, width = '100%', height = 'auto' } = imageItem;
            
            return `
                <div class="image-embed mb-6">
                    <div class="relative group">
                        <img 
                            src="${url}" 
                            alt="${title || 'Image'}"
                            class="w-full rounded-lg shadow-lg cursor-pointer transition-transform duration-300 group-hover:scale-105"
                            style="max-width: ${width}; height: ${height};"
                            onclick="openImageModal('${url}', '${title || 'Image'}')"
                            loading="lazy"
                        >
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all duration-300 rounded-lg flex items-center justify-center">
                            <svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                            </svg>
                        </div>
                    </div>
                    ${title ? `<h4 class="text-white font-semibold mt-3">${title}</h4>` : ''}
                    ${description ? `<p class="text-gray-300 text-sm mt-2">${description}</p>` : ''}
                </div>
            `;
        }

        function createAudioEmbed(audioItem) {
            const { url, title, description, autoplay = false } = audioItem;
            
            return `
                <div class="audio-embed mb-6 bg-gray-800 bg-opacity-50 rounded-lg p-4">
                    <audio 
                        class="w-full"
                        controls
                        ${autoplay ? 'autoplay' : ''}
                        preload="metadata">
                        <source src="${url}" type="audio/mpeg">
                        <source src="${url}" type="audio/wav">
                        <source src="${url}" type="audio/ogg">
                        Your browser does not support the audio element.
                    </audio>
                    ${title ? `<h4 class="text-white font-semibold mt-3">${title}</h4>` : ''}
                    ${description ? `<p class="text-gray-300 text-sm mt-2">${description}</p>` : ''}
                </div>
            `;
        }

        // Helper functions
        function extractYouTubeID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        function extractVimeoID(url) {
            const regExp = /^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/)|(staff\/picks\/)|(video\/))?([0-9]+)/;
            const match = url.match(regExp);
            return match ? match[7] : null;
        }

        function initializeEmbeddedContent() {
            // Initialize any special embedded content that needs JavaScript
            // This could include lazy loading, analytics, etc.
        }

        function openImageModal(imageUrl, title) {
            // Create and show image modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full p-4">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            class="absolute -top-2 -right-2 w-10 h-10 bg-gray-800 hover:bg-gray-700 rounded-full flex items-center justify-center text-white z-10">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                    <img src="${imageUrl}" alt="${title}" class="max-w-full max-h-full rounded-lg">
                    ${title !== 'Image' ? `<p class="text-center text-white mt-4 text-lg">${title}</p>` : ''}
                </div>
            `;
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }

        function navigateToNode(nodeId) {
            // Fade out current content
            const container = document.getElementById('content-container');
            container.style.opacity = '0';
            
            setTimeout(() => {
                loadNode(nodeId);
                container.style.opacity = '1';
            }, 300);
        }

        function returnToUniverse() {
            // Hide content container
            const contentContainer = document.getElementById('content-container');
            contentContainer.classList.remove('active');
            document.body.style.overflow = 'hidden';
            
            // Reset to initial state - destroy current scene and restart
            isTransitioning = true;
            
            // Clear the scene
            if (scene) {
                while(scene.children.length > 0){ 
                    scene.remove(scene.children[0]); 
                }
            }
            
            // Clear particles array
            particles = [];
            
            // Reset animation phase
            animationPhase = 'initial';
            
            setTimeout(() => {
                const canvas = document.getElementById('canvas-container');
                canvas.style.opacity = '1';
                
                // Restart the entire 3D experience from the beginning
                setupThreeJS();
                startAnimation();
                
                isTransitioning = false;
            }, 1000);
        }

        function showConfig() {
            document.getElementById('config-container').classList.add('active');
            loadCurrentJSON();
        }

        // File upload handling
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                showStatusMessage('Please select a valid JSON file.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonText = e.target.result;
                    const parsedData = JSON.parse(jsonText);
                    
                    // Validate structure
                    if (validateJSONStructure(parsedData)) {
                        document.getElementById('json-editor').value = JSON.stringify(parsedData, null, 2);
                        updateStats();
                        showStatusMessage('JSON file loaded successfully!', 'success');
                        updateJSONStatus('Valid', 'success');
                    } else {
                        showStatusMessage('Invalid JSON structure. Please check the format.', 'error');
                        updateJSONStatus('Invalid', 'error');
                    }
                } catch (error) {
                    showStatusMessage('Error parsing JSON file: ' + error.message, 'error');
                    updateJSONStatus('Error', 'error');
                }
            };
            
            reader.onerror = function() {
                showStatusMessage('Error reading file.', 'error');
            };
            
            reader.readAsText(file);
        }

        function loadCurrentJSON() {
            // Create default data structure for the config editor
            const defaultData = {
                "startNode": "node1",
                "nodes": {
                    "node1": {
                        "question": "What is Consciousness?",
                        "answer": "Consciousness is the fundamental awareness that underlies all existence. It is the ground of being from which all phenomena arise and into which they dissolve. Rather than being produced by the brain, consciousness is the very fabric of reality itself - the aware presence in which all experiences occur. This primordial awareness is not personal or limited, but is the universal field of knowing that pervades everything.",
                        "followUps": [
                            {
                                "prompt": "If everything is Consciousness, then what is God?",
                                "nextNodeId": "node2"
                            },
                            {
                                "prompt": "How does individual awareness emerge from universal consciousness?",
                                "nextNodeId": "node4"
                            }
                        ]
                    },
                    "node2": {
                        "question": "What is God?",
                        "answer": "God is not a separate being or entity, but the very essence of Consciousness itself. God is the infinite, eternal awareness that is both the source and substance of all existence. When we speak of God, we are pointing to that which is most intimate and immediate - the 'I AM' presence that you are right now. God is not somewhere else; God is the very consciousness through which you are reading these words. The divine is not transcendent in the sense of being apart from creation, but is the very being of creation itself.",
                        "followUps": [
                            {
                                "prompt": "What is the purpose of creation?",
                                "nextNodeId": "node3"
                            },
                            {
                                "prompt": "Why does the infinite appear as the finite?",
                                "nextNodeId": "node5"
                            }
                        ]
                    },
                    "node3": {
                        "question": "What is the purpose of creation?",
                        "answer": "Creation exists for the sheer joy of being and knowing itself. Like an artist who creates not from necessity but from love, Consciousness manifests the universe as an expression of its infinite creative potential. There is no external purpose or goal - the purpose is the very expression itself. Each moment, each being, each experience is Consciousness exploring and celebrating its own infinite nature. The purpose of creation is play, love, and the endless celebration of being.",
                        "followUps": [
                            {
                                "prompt": "How do we recognize our true nature?",
                                "nextNodeId": "node6"
                            }
                        ]
                    },
                    "node4": {
                        "question": "How does individual awareness emerge?",
                        "answer": "Individual awareness is like a wave on the ocean - it appears to be separate but is never actually apart from the whole. The universal consciousness, through a divine play of forgetting and remembering, seems to localize itself into countless points of individual experience. Yet this apparent separation is only a play of appearances. The wave is always ocean, and individual awareness is always the one universal consciousness experiencing itself from a particular perspective.",
                        "followUps": [
                            {
                                "prompt": "What is the purpose of creation?",
                                "nextNodeId": "node3"
                            }
                        ]
                    },
                    "node5": {
                        "question": "Why does the infinite appear as the finite?",
                        "answer": "The infinite appears as the finite not because it becomes limited, but because it is so unlimited that it can even appear to limit itself. This is the supreme freedom of consciousness - the ability to play all roles, to experience all possibilities. The infinite doesn't become finite; rather, the finite is how the infinite appears to itself. It's like an actor who is so skilled they can completely embody any character while never ceasing to be themselves.",
                        "followUps": [
                            {
                                "prompt": "How do we recognize our true nature?",
                                "nextNodeId": "node6"
                            }
                        ]
                    },
                    "node6": {
                        "question": "How do we recognize our true nature?",
                        "answer": "Recognition of our true nature doesn't require acquiring something new, but rather the falling away of what we are not. Simply notice the awareness that is present right now - the knowing presence in which thoughts, feelings, and perceptions appear. This awareness is not personal; it is the same consciousness that knows itself in all beings. The recognition is immediate and intimate: 'I AM' - not 'I am something' but simply the pure fact of being aware. This is your true face, the consciousness you have always been.",
                        "followUps": []
                    }
                }
            };
            
            // Add example with media to show the new capabilities
            const exampleWithMedia = {
                "startNode": "node1",
                "nodes": {
                    "node1": {
                        "question": "What is Consciousness?",
                        "answer": "Consciousness is the fundamental awareness that underlies all existence...",
                        "media": [
                            {
                                "type": "video",
                                "url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
                                "title": "Understanding Consciousness",
                                "description": "A deep dive into the nature of awareness"
                            },
                            {
                                "type": "link",
                                "url": "https://example.com/consciousness-article",
                                "title": "Scientific Studies on Consciousness",
                                "description": "Latest research and findings in consciousness studies",
                                "image": "https://example.com/preview.jpg",
                                "domain": "example.com"
                            },
                            {
                                "type": "image",
                                "url": "https://example.com/brain-image.jpg",
                                "title": "The Conscious Brain",
                                "description": "Neural pathways of awareness"
                            },
                            {
                                "type": "audio",
                                "url": "https://example.com/meditation.mp3",
                                "title": "Guided Consciousness Meditation",
                                "description": "10-minute awareness practice"
                            }
                        ],
                        "followUps": [
                            {
                                "prompt": "If everything is Consciousness, then what is God?",
                                "nextNodeId": "node2"
                            }
                        ]
                    }
                }
            };
            
            // Use loaded data if available, otherwise use default with media example
            const dataToShow = contentData || exampleWithMedia;
            document.getElementById('json-editor').value = JSON.stringify(dataToShow, null, 2);
            updateStats();
            showStatusMessage('Data loaded into editor!', 'success');
            updateJSONStatus('Valid', 'success');
        }

        function saveJSON() {
            const jsonText = document.getElementById('json-editor').value;
            try {
                const parsedData = JSON.parse(jsonText);
                
                if (!validateJSONStructure(parsedData)) {
                    showStatusMessage('Invalid JSON structure. Please validate before downloading.', 'error');
                    return;
                }
                
                const blob = new Blob([jsonText], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'data.json';
                a.click();
                
                URL.revokeObjectURL(url);
                
                showStatusMessage('JSON file downloaded successfully!', 'success');
                updateJSONStatus('Downloaded', 'success');
            } catch (error) {
                showStatusMessage('Invalid JSON format: ' + error.message, 'error');
                updateJSONStatus('Error', 'error');
            }
        }

        function validateJSON() {
            const jsonText = document.getElementById('json-editor').value;
            try {
                const parsedData = JSON.parse(jsonText);
                
                if (validateJSONStructure(parsedData)) {
                    showStatusMessage('JSON is valid and properly structured!', 'success');
                    updateJSONStatus('Valid', 'success');
                } else {
                    showStatusMessage('JSON syntax is valid but structure is incorrect.', 'warning');
                    updateJSONStatus('Warning', 'warning');
                }
            } catch (error) {
                showStatusMessage('JSON syntax error: ' + error.message, 'error');
                updateJSONStatus('Invalid', 'error');
            }
        }

        function validateJSONStructure(data) {
            if (!data.startNode || !data.nodes) return false;
            
            const startNodeExists = data.nodes[data.startNode];
            if (!startNodeExists) return false;
            
            for (const nodeId in data.nodes) {
                const node = data.nodes[nodeId];
                if (!node.question || !node.answer || !Array.isArray(node.followUps)) {
                    return false;
                }
                
                for (const followUp of node.followUps) {
                    if (!followUp.prompt || !followUp.nextNodeId) return false;
                }
            }
            
            return true;
        }

        function formatJSON() {
            const jsonText = document.getElementById('json-editor').value;
            try {
                const parsedData = JSON.parse(jsonText);
                document.getElementById('json-editor').value = JSON.stringify(parsedData, null, 2);
                updateStats();
                showStatusMessage('JSON formatted successfully!', 'success');
                updateJSONStatus('Formatted', 'success');
            } catch (error) {
                showStatusMessage('Cannot format invalid JSON: ' + error.message, 'error');
                updateJSONStatus('Error', 'error');
            }
        }

        function previewChanges() {
            const jsonText = document.getElementById('json-editor').value;
            try {
                const parsedData = JSON.parse(jsonText);
                
                if (!validateJSONStructure(parsedData)) {
                    showStatusMessage('Cannot preview: Invalid JSON structure.', 'error');
                    return;
                }
                
                // Temporarily update the content data
                const originalData = { ...contentData };
                Object.assign(contentData, parsedData);
                
                // Show preview message
                showStatusMessage('Preview mode activated! Changes are temporary until downloaded.', 'info');
                
                // Return to main experience to see changes
                setTimeout(() => {
                    window.location.hash = '';
                    location.reload();
                }, 2000);
                
            } catch (error) {
                showStatusMessage('Cannot preview invalid JSON: ' + error.message, 'error');
            }
        }

        function copyToClipboard() {
            const jsonText = document.getElementById('json-editor').value;
            navigator.clipboard.writeText(jsonText).then(() => {
                showStatusMessage('JSON copied to clipboard!', 'success');
            }).catch(() => {
                showStatusMessage('Failed to copy to clipboard.', 'error');
            });
        }

        function clearEditor() {
            if (confirm('Are you sure you want to clear the editor? This cannot be undone.')) {
                document.getElementById('json-editor').value = '';
                updateStats();
                showStatusMessage('Editor cleared.', 'info');
                updateJSONStatus('Empty', 'warning');
            }
        }

        function updateStats() {
            const jsonText = document.getElementById('json-editor').value;
            const lines = jsonText.split('\n').length;
            const chars = jsonText.length;
            
            document.getElementById('line-count').textContent = lines;
            document.getElementById('char-count').textContent = chars;
            
            try {
                const data = JSON.parse(jsonText);
                const nodeCount = data.nodes ? Object.keys(data.nodes).length : 0;
                document.getElementById('node-count').textContent = nodeCount;
            } catch {
                document.getElementById('node-count').textContent = '?';
            }
        }

        function updateJSONStatus(status, type) {
            const statusElement = document.getElementById('json-status');
            statusElement.textContent = status;
            
            // Reset classes
            statusElement.className = 'ml-auto text-sm px-2 py-1 rounded-full';
            
            switch (type) {
                case 'success':
                    statusElement.classList.add('bg-green-700', 'text-green-200');
                    break;
                case 'error':
                    statusElement.classList.add('bg-red-700', 'text-red-200');
                    break;
                case 'warning':
                    statusElement.classList.add('bg-amber-700', 'text-amber-200');
                    break;
                case 'info':
                    statusElement.classList.add('bg-blue-700', 'text-blue-200');
                    break;
                default:
                    statusElement.classList.add('bg-gray-700', 'text-gray-300');
            }
        }

        function showStatusMessage(message, type) {
            const messageElement = document.getElementById('status-message');
            const textElement = document.getElementById('status-text');
            
            textElement.textContent = message;
            messageElement.className = 'mb-6 p-4 rounded-lg border';
            
            switch (type) {
                case 'success':
                    messageElement.classList.add('bg-green-900', 'border-green-500', 'text-green-200');
                    break;
                case 'error':
                    messageElement.classList.add('bg-red-900', 'border-red-500', 'text-red-200');
                    break;
                case 'warning':
                    messageElement.classList.add('bg-amber-900', 'border-amber-500', 'text-amber-200');
                    break;
                case 'info':
                    messageElement.classList.add('bg-blue-900', 'border-blue-500', 'text-blue-200');
                    break;
                default:
                    messageElement.classList.add('bg-gray-900', 'border-gray-500', 'text-gray-200');
            }
            
            messageElement.classList.remove('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageElement.classList.add('hidden');
            }, 5000);
        }

        function handleEditorKeydown(event) {
            // Add tab support for better JSON editing
            if (event.key === 'Tab') {
                event.preventDefault();
                const textarea = event.target;
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                
                textarea.value = textarea.value.substring(0, start) + '  ' + textarea.value.substring(end);
                textarea.selectionStart = textarea.selectionEnd = start + 2;
                updateStats();
            }
        }

        function returnToMain() {
            window.location.hash = '';
            location.reload();
        }

        function onWindowResize() {
            if (!camera || !renderer) return;
            
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Handle URL hash changes
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            if (hash === 'config') {
                showConfig();
            } else if (hash === '') {
                // Returning to main experience
                document.getElementById('config-container').classList.remove('active');
                if (!contentData) {
                    loadDataFromFile();
                }
            }
        });

        // Initialize the application
        init();
    </script>
</body>
</html>